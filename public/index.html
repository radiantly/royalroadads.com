<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Royal Road Ads</title>
    <style>
      :root {
        --grid-padding: 10px;
        --yellow: #fff54b;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        margin: 0;
        min-height: 100vh;
      }
      body {
        display: flex;
        justify-content: center;
        color: #fefefe;
        background-color: #0f0f0f;
        font-family: "Dot Matrix";
        overflow-x: hidden;
      }
      .yellow {
        color: var(--yellow);
      }
      .container {
        display: flex;
        flex-direction: column;
      }
      nav {
        display: flex;
        padding: 24px 0;
        position: relative;
        z-index: 42;
      }
      nav .logo {
        font-size: 24px;
      }
      .ad-grid {
        display: flex;
        flex-direction: column;
        gap: var(--grid-padding);
      }
      .ad-row {
        display: flex;
        gap: var(--grid-padding);
        justify-content: center;
        min-width: 0;
      }
      .ad-row a {
        position: relative;
        display: flex;
      }
      .ad-row a div.backdrop {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        transition: opacity 0.5s ease;
        pointer-events: none;
      }
      .ad-row a:hover div.backdrop {
        opacity: 1;
      }
      .ad-row a div.backdrop::before {
        content: "";
        position: absolute;
        top: -15%;
        left: -15%;
        bottom: -15%;
        right: -15%;
        backdrop-filter: blur(15px);
      }
      .ad-row a img {
        position: relative;
        z-index: 42;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <nav>
        <div class="logo">Royal Road <span class="yellow">Ads</span></div>
      </nav>
      <div class="ad-grid"></div>
    </div>
    <script>
      const padding = 10;
      const width = 300;
      let currentPerRow = null;
      const handleData = ({ entries }) => {
        window.addEventListener("resize", (e) => handleData({ entries }), {
          once: true,
        });

        const perRow = Math.floor(
          (window.innerWidth + padding) / (width + padding)
        );
        console.log(perRow);

        if (currentPerRow === perRow) return;
        else currentPerRow = perRow;

        console.log(entries);

        const adRows = [];
        for (const [uid, entry] of Object.entries(entries)) {
          const isOdd = (adRows.length + 1) % 2;
          if (
            (adRows.at(-1)?.childElementCount ?? Infinity) >=
            perRow - isOdd
          ) {
            const adRow = document.createElement("div");
            adRow.classList.add("ad-row");
            adRows.push(adRow);
          }

          const a = document.createElement("a");
          a.href = entry.link;
          a.target = "_blank";
          const img = document.createElement("img");
          img.src = `300x250/${uid}.webp`;
          img.alt = entry.alt;
          img.title = entry.alt;

          const backdrop = document.createElement("div");
          backdrop.classList.add("backdrop");
          backdrop.style.background = `url("${img.src}")`;
          a.replaceChildren(backdrop, img);
          adRows.at(-1).appendChild(a);
        }

        document.querySelector(".ad-grid").replaceChildren(...adRows);
      };

      fetch("300x250/entries.json")
        .then((response) => response.json())
        .then(handleData);
    </script>
  </body>
</html>
